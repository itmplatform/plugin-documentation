{
    "name": "e4-hubspot-clients-3",
    "svgString": "",
    "details": {
        "title": {
            "en": "E4. Syncs Hubspot's companies",
            "es": "E4. Sincroniza las compañías de Hubspot",
            "pt": "E4. Sincroniza as empresas da Hubspot"
        },
        "version": "0.8",
        "shortDescription": {
            "en": "Example 4. Syncs Hubspot's companies into ITM Platform's clients",
            "es": "Ejemplo 4. Sincroniza las compañías de Hubspot con clientes de ITM Platform",
            "pt": "Exemplo 4. Sincroniza as empresas da Hubspot nos clientes da ITM Platform"
        },
        "longDescription": {
            "en": "",
            "es": "",
            "pt": ""
        },
        "updated": "2022-04-05",
        "developer": "ITM Platform"
    },
    "features": [
        {
            "trigger": "scheduler",
            "description": "Syncs companies from Hubspot",
            "async": true,
            "actions": [
                {
                    "action": "restcall",
                    "url": "@@ITMAPI@@/@@AccountName@@/login/{{ config.apikey }}",
                    "method": "GET",
                    "description": "Login with API Key",
                    "output": "loginInfo",
                    "payload": "",
                    "dataType": "application/json"
                },
                {
                    "action": "restcall",
                    "url": "https://api.hubapi.com/crm/v3/objects/companies/search/?hapikey={{ config.apikeyHubspot }}",
                    "method": "POST",
                    "description": "Retrieve all companies that have the sync_itm_platform field set to true",
                    "output": "companiesHS",
                    "payload": "{\"properties\": [ \"name\",\"address\",\"city\",\"state\", \"phone\" ], \"filterGroups\": [ { \"filters\": [ { \"propertyName\": \"sync_itm_platform\", \"operator\": \"EQ\", \"value\": \"true\" } ] } ]}",
                    "dataType": "application/json"
                },
                {
                    "action": "loop",
                    "description": "At this point, we have the object companiesHS, we need to loop through them.",
                    "loop": {
                        "var": "companiesHS.results",
                        "output": "singleCompanyHS",
                        "condition": "1 == 1"
                    },
                    "actions": [
                        {
                            "action": "restcall",
                            "url": "@@ITMAPI@@/@@AccountName@@/clients/?FiscalId={{ singleCompanyHS.id }}",
                            "method": "GET",
                            "token": "{{ loginInfo.Token }}",
                            "description": "Retrieves the client from ITM Platform that matches de Fiscal ID (Company Id on Hubspot)",
                            "output": "clientsMatchingFiscalId",
                            "payload": "",
                            "dataType": "application/json"
                        },
                        {
                            "action": "restcall",
                            "url": "@@ITMAPI@@/v2/@@AccountName@@/clients/",
                            "condition": "Convert.ToString(clientsMatchingFiscalId).length == 0",
                            "method": "POST",
                            "token": "{{ loginInfo.Token }}",
                            "description": "If clientsMatchingFiscalId.length ==  0, that means we need to create the company on ITM Platform for the first time",
                            "output": "",
                            "payload": "{\"FiscalId\": \"{{ singleCompanyHS.id }}\", \"Name\": \"{{ singleCompanyHS.properties.name }}\" }",
                            "dataType": "application/json"
                        },
                        {
                            "action": "restcall",
                            "url": "@@ITMAPI@@/v2/@@AccountName@@/clients/{{clientsMatchingFiscalId.0.ClientId}}",
                            "condition": "Convert.ToString(clientsMatchingFiscalId).length > 0",
                            "method": "PATCH",
                            "token": "{{ loginInfo.Token }}",
                            "description": "If clientsMatchingFiscalId.length >  0, that means that we just need to update it",
                            "output": "",
                            "payload": "{\"FiscalId\": \"{{ singleCompanyHS.id }}\", \"Name\": \"{{ singleCompanyHS.properties.name }}\" }",
                            "dataType": "application/json"
                        }
                    ]
                }
            ]
        }
    ],
    "config": [
        {
            "name": "isactive",
            "label": {
                "en": "Activate connector",
                "es": "Activar conector",
                "pt": "Ativar o conector"
            },
            "tooltip": {
                "en": "When selected, the connector will be active and will start synchronizing data",
                "es": "Cuando esté seleccionado, el conector estará activo y comenzará a sincronizar datos",
                "pt": "Quando selecionado, o conector estará ativo e começará a sincronizar dados"
            },
            "type": "checkbox",
            "required": false
        },
        {
            "name": "apikey",
            "label": {
                "en": "API Key",
                "es": "API Key",
                "pt": "API Key"
            },
            "tooltip": {
                "en": "API Key",
                "es": "API Key",
                "pt": "API Key"
            },
            "type": "string",
            "required": true
        },
        {
            "name": "apikeyHubspot",
            "label": {
                "en": "Hubspot API Key",
                "es": "Hubspot API Key",
                "pt": "Hubspot API Key"
            },
            "tooltip": {
                "en": " HubspotAPI Key",
                "es": "Hubspot API Key",
                "pt": "Hubspot API Key"
            },
            "type": "string",
            "required": true
        },
        {
            "name": "synchronizationfrequency",
            "label": {
                "en": "Synchronization frequency (minutes)",
                "es": "Frecuencia sincronización (minutos)",
                "pt": "Frequência de sincronização (em minutos)"
            },
            "tooltip": {
                "en": "Frequency you wish to establish for the synchronization of the data from you Hubspot account",
                "es": "Frecuencia con la que prefieres establecer la sincronización de los datos de tu cuenta de Hubspot",
                "pt": "Frequência com que prefere estabelecer a sincronização de dados de sua conta Hubspot"
            },
            "type": "string",
            "required": true
        }
    ]
}